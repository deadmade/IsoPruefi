<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IsoPruefi Arduino: src/mqtt.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IsoPruefi Arduino
   </div>
   <div id="projectbrief">Arduino firmware for IsoPruefi temperature monitoring system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">mqtt.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="mqtt_8h_source.html">mqtt.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="storage_8h_source.html">storage.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3b3cc778b2593946d67d627e9e2b4aa5" id="r_a3b3cc778b2593946d67d627e9e2b4aa5"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a3b3cc778b2593946d67d627e9e2b4aa5">ExtractSequence</a> (const char *json, long &amp;outSeq)</td></tr>
<tr class="memdesc:a3b3cc778b2593946d67d627e9e2b4aa5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Extracts the sequence number from a JSON string.  <br /></td></tr>
<tr class="separator:a3b3cc778b2593946d67d627e9e2b4aa5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2487e7989185134f386a99d2f543323" id="r_ab2487e7989185134f386a99d2f543323"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#ab2487e7989185134f386a99d2f543323">OnMqttEchoMessage</a> (int messageSize)</td></tr>
<tr class="memdesc:ab2487e7989185134f386a99d2f543323"><td class="mdescLeft">&#160;</td><td class="mdescRight">MQTT message callback to detect PUBACK/echo for published messages.  <br /></td></tr>
<tr class="separator:ab2487e7989185134f386a99d2f543323"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad0630aec62807d4c5e88f3720ab92bc7" id="r_ad0630aec62807d4c5e88f3720ab92bc7"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#ad0630aec62807d4c5e88f3720ab92bc7">EnsureAckInit</a> (MqttClient &amp;client, const char *topicPrefix, const char *sensorType, const char *sensorId)</td></tr>
<tr class="memdesc:ad0630aec62807d4c5e88f3720ab92bc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes ACK/Echo handling and subscribes to the publish MQTT_TOPIC.  <br /></td></tr>
<tr class="separator:ad0630aec62807d4c5e88f3720ab92bc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ef5b8e2eb44288d4294967dd9c978bc" id="r_a6ef5b8e2eb44288d4294967dd9c978bc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a6ef5b8e2eb44288d4294967dd9c978bc">CreateFullTopic</a> (char *buffer, size_t bufferSize, const char *topicPrefix, const char *sensorType, const char *sensorId, const char *suffix)</td></tr>
<tr class="separator:a6ef5b8e2eb44288d4294967dd9c978bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa85ccfd4bec75d36415a21ab5696deef" id="r_aa85ccfd4bec75d36415a21ab5696deef"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#aa85ccfd4bec75d36415a21ab5696deef">SendTempToMqtt</a> (MqttClient &amp;<a class="el" href="mqtt_8h.html#aaf73b36dfdb5cafe8dbb8ca7563f7e56">mqttClient</a>, const char *topicPrefix, const char *sensorType, const char *sensorId, float celsius, const DateTime &amp;now, int sequence)</td></tr>
<tr class="memdesc:aa85ccfd4bec75d36415a21ab5696deef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publishes real-time sensor data to the MQTT broker with QoS 1 delivery.  <br /></td></tr>
<tr class="separator:aa85ccfd4bec75d36415a21ab5696deef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eff2f450ca7353750649b94936d6cee" id="r_a7eff2f450ca7353750649b94936d6cee"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a7eff2f450ca7353750649b94936d6cee">SendPendingDataToMqtt</a> (MqttClient &amp;<a class="el" href="mqtt_8h.html#aaf73b36dfdb5cafe8dbb8ca7563f7e56">mqttClient</a>, const char *topicPrefix, const char *sensorType, const char *sensorId, const DateTime &amp;now)</td></tr>
<tr class="memdesc:a7eff2f450ca7353750649b94936d6cee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes and transmits pending CSV files from offline periods to the MQTT broker.  <br /></td></tr>
<tr class="separator:a7eff2f450ca7353750649b94936d6cee"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a01d5af4481e953ac242d59bd4c22765f" id="r_a01d5af4481e953ac242d59bd4c22765f"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a01d5af4481e953ac242d59bd4c22765f">SMALL_BUFFER_SIZE</a> = 128</td></tr>
<tr class="memdesc:a01d5af4481e953ac242d59bd4c22765f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer size for small MQTT topics, payloads, and JSON documents.  <br /></td></tr>
<tr class="separator:a01d5af4481e953ac242d59bd4c22765f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abafcc50ab7d3b296d64e26083a1a876e" id="r_abafcc50ab7d3b296d64e26083a1a876e"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#abafcc50ab7d3b296d64e26083a1a876e">LARGE_BUFFER_SIZE</a> = 2048</td></tr>
<tr class="memdesc:abafcc50ab7d3b296d64e26083a1a876e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer size for large MQTT payloads and JSON documents (recovery data)  <br /></td></tr>
<tr class="separator:abafcc50ab7d3b296d64e26083a1a876e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4d6a09459b76d7be490a8804e8bffe4" id="r_aa4d6a09459b76d7be490a8804e8bffe4"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#aa4d6a09459b76d7be490a8804e8bffe4">FILE_NAME_BUFFER_SIZE</a> = 64</td></tr>
<tr class="separator:aa4d6a09459b76d7be490a8804e8bffe4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a407875f5e946a88244a5d566c3d29d03" id="r_a407875f5e946a88244a5d566c3d29d03"><td class="memItemLeft" align="right" valign="top">static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a407875f5e946a88244a5d566c3d29d03">MAX_RECOVERY_FILES_PER_LOOP</a> = 3</td></tr>
<tr class="separator:a407875f5e946a88244a5d566c3d29d03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a633b6d91d2a6b9fe94d49679bf76cf8d" id="r_a633b6d91d2a6b9fe94d49679bf76cf8d"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a633b6d91d2a6b9fe94d49679bf76cf8d">FOLDER_NAME_BUFFER_SIZE</a> = 8</td></tr>
<tr class="separator:a633b6d91d2a6b9fe94d49679bf76cf8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac89604b3a86db0dabb5538b2f3a5cdd6" id="r_ac89604b3a86db0dabb5538b2f3a5cdd6"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#ac89604b3a86db0dabb5538b2f3a5cdd6">FULL_PATH_BUFFER_SIZE</a> = 64</td></tr>
<tr class="separator:ac89604b3a86db0dabb5538b2f3a5cdd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb1c8ff7f876cef50bab38d6ac9a4d10" id="r_abb1c8ff7f876cef50bab38d6ac9a4d10"><td class="memItemLeft" align="right" valign="top">static const size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#abb1c8ff7f876cef50bab38d6ac9a4d10">LINE_BUFFER_SIZE</a> = 64</td></tr>
<tr class="memdesc:abb1c8ff7f876cef50bab38d6ac9a4d10"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer size for reading individual CSV lines.  <br /></td></tr>
<tr class="separator:abb1c8ff7f876cef50bab38d6ac9a4d10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a700fb0855fc0d557992d5068df21e937" id="r_a700fb0855fc0d557992d5068df21e937"><td class="memItemLeft" align="right" valign="top">static const uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a700fb0855fc0d557992d5068df21e937">SECONDS_IN_24_HOURS</a> = 86400</td></tr>
<tr class="separator:a700fb0855fc0d557992d5068df21e937"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fa547868639ebfd54dcfd92dc6f0dc7" id="r_a8fa547868639ebfd54dcfd92dc6f0dc7"><td class="memItemLeft" align="right" valign="top">static const unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a8fa547868639ebfd54dcfd92dc6f0dc7">RECOVERY_TIMEOUT_MS</a> = 60000</td></tr>
<tr class="memdesc:a8fa547868639ebfd54dcfd92dc6f0dc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timeout for recovery operations in milliseconds (60 seconds)  <br /></td></tr>
<tr class="separator:a8fa547868639ebfd54dcfd92dc6f0dc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba2b7ae1d49c468937bdcded3695352b" id="r_aba2b7ae1d49c468937bdcded3695352b"><td class="memItemLeft" align="right" valign="top">static const unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#aba2b7ae1d49c468937bdcded3695352b">ACK_TIMEOUT_MS</a> = 5000</td></tr>
<tr class="separator:aba2b7ae1d49c468937bdcded3695352b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1462ad318bc6cd52a0b6ce826ca946c" id="r_ad1462ad318bc6cd52a0b6ce826ca946c"><td class="memItemLeft" align="right" valign="top">static const unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#ad1462ad318bc6cd52a0b6ce826ca946c">RECOVERY_ACK_TIMEOUT_MS</a> = 10000</td></tr>
<tr class="separator:ad1462ad318bc6cd52a0b6ce826ca946c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4ded6926a35bdbecaf8318908797a51" id="r_ac4ded6926a35bdbecaf8318908797a51"><td class="memItemLeft" align="right" valign="top">static const unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#ac4ded6926a35bdbecaf8318908797a51">DELAY_POLLING_LOOP_MS</a> = 10</td></tr>
<tr class="separator:ac4ded6926a35bdbecaf8318908797a51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5cdeb03df0da73c08309eb1693816f4" id="r_ad5cdeb03df0da73c08309eb1693816f4"><td class="memItemLeft" align="right" valign="top">static volatile bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#ad5cdeb03df0da73c08309eb1693816f4">s_ackSeen</a> = false</td></tr>
<tr class="separator:ad5cdeb03df0da73c08309eb1693816f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af87e53fea3cf7b797a5bd30588380511" id="r_af87e53fea3cf7b797a5bd30588380511"><td class="memItemLeft" align="right" valign="top">static volatile long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#af87e53fea3cf7b797a5bd30588380511">s_ackSeq</a> = -1</td></tr>
<tr class="separator:af87e53fea3cf7b797a5bd30588380511"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a365552749e351abf6c38ffb0946ae993" id="r_a365552749e351abf6c38ffb0946ae993"><td class="memItemLeft" align="right" valign="top">static String&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a365552749e351abf6c38ffb0946ae993">s_pubTopic</a></td></tr>
<tr class="separator:a365552749e351abf6c38ffb0946ae993"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8671bf831d0fbe6895dfdf718ba4ca1c" id="r_a8671bf831d0fbe6895dfdf718ba4ca1c"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8cpp.html#a8671bf831d0fbe6895dfdf718ba4ca1c">s_ackInit</a> = false</td></tr>
<tr class="separator:a8671bf831d0fbe6895dfdf718ba4ca1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a6ef5b8e2eb44288d4294967dd9c978bc" name="a6ef5b8e2eb44288d4294967dd9c978bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ef5b8e2eb44288d4294967dd9c978bc">&#9670;&#160;</a></span>CreateFullTopic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CreateFullTopic </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bufferSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topicPrefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>suffix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad0630aec62807d4c5e88f3720ab92bc7" name="ad0630aec62807d4c5e88f3720ab92bc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad0630aec62807d4c5e88f3720ab92bc7">&#9670;&#160;</a></span>EnsureAckInit()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void EnsureAckInit </td>
          <td>(</td>
          <td class="paramtype">MqttClient &amp;&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topicPrefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorId</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initializes ACK/Echo handling and subscribes to the publish MQTT_TOPIC. </p>
<p>Sets up the publish MQTT_TOPIC and registers the MQTT message callback for echo detection. Ensures the callback is registered only once, and re-subscribes to the MQTT_TOPIC after each reconnect.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client</td><td>Reference to the MQTT client </td></tr>
    <tr><td class="paramname">topicPrefix</td><td>Topic prefix for MQTT publishing </td></tr>
    <tr><td class="paramname">sensorType</td><td>Sensor type string </td></tr>
    <tr><td class="paramname">sensorId</td><td>Unique sensor identifier </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a3b3cc778b2593946d67d627e9e2b4aa5" name="a3b3cc778b2593946d67d627e9e2b4aa5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3b3cc778b2593946d67d627e9e2b4aa5">&#9670;&#160;</a></span>ExtractSequence()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool ExtractSequence </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>json</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long &amp;&#160;</td>
          <td class="paramname"><em>outSeq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Extracts the sequence number from a JSON string. </p>
<p>Searches for the "sequence" field in the provided JSON and parses its value. Returns false if the field is missing or set to null.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>The JSON string to search </td></tr>
    <tr><td class="paramname">outSeq</td><td>Reference to store the extracted sequence number </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if a valid sequence number was found, false otherwise </dd></dl>

</div>
</div>
<a id="ab2487e7989185134f386a99d2f543323" name="ab2487e7989185134f386a99d2f543323"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2487e7989185134f386a99d2f543323">&#9670;&#160;</a></span>OnMqttEchoMessage()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void OnMqttEchoMessage </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>messageSize</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>MQTT message callback to detect PUBACK/echo for published messages. </p>
<p>Processes incoming MQTT messages, filtering by MQTT_TOPIC and retain flag. If the message is an echo for the current publish MQTT_TOPIC and not retained, extracts the sequence number and sets acknowledgment flags.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">messageSize</td><td>Size of the incoming message (needed because of the MQTT library's callback interface) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a7eff2f450ca7353750649b94936d6cee" name="a7eff2f450ca7353750649b94936d6cee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7eff2f450ca7353750649b94936d6cee">&#9670;&#160;</a></span>SendPendingDataToMqtt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SendPendingDataToMqtt </td>
          <td>(</td>
          <td class="paramtype">MqttClient &amp;&#160;</td>
          <td class="paramname"><em>mqttClient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topicPrefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DateTime &amp;&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes and transmits pending CSV files from offline periods to the MQTT broker. </p>
<p>This function scans the SD card for CSV files containing unsent sensor data from previous offline periods. Each file is converted to a JSON payload and published to the MQTT topic &lt;topic&gt;/recovered with QoS 1. After publishing, it waits briefly for a PUBACK handshake from the broker to confirm delivery. If the PUBACK is not received within the timeout period, the file is saved for later transmission. Files are only deleted if the publish operation succeeds. Files older than 24 hours or with invalid data are skipped.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mqttClient</td><td>Reference to the MQTT client instance </td></tr>
    <tr><td class="paramname">topicPrefix</td><td>Topic prefix for MQTT publishing (e.g., "dhbw/ai/si2023/2/") </td></tr>
    <tr><td class="paramname">sensorType</td><td>Sensor type string (e.g., "temp") </td></tr>
    <tr><td class="paramname">sensorId</td><td>Unique sensor identifier </td></tr>
    <tr><td class="paramname">now</td><td>Current timestamp (DateTime) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if all valid files were published and deleted, false if any files remain or errors occurred</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Uses QoS 1 for reliable delivery. Skips files older than 24 hours or with invalid content. Aborts if recovery exceeds time limit. </dd></dl>

</div>
</div>
<a id="aa85ccfd4bec75d36415a21ab5696deef" name="aa85ccfd4bec75d36415a21ab5696deef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa85ccfd4bec75d36415a21ab5696deef">&#9670;&#160;</a></span>SendTempToMqtt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SendTempToMqtt </td>
          <td>(</td>
          <td class="paramtype">MqttClient &amp;&#160;</td>
          <td class="paramname"><em>mqttClient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topicPrefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>celsius</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DateTime &amp;&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sequence</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publishes real-time sensor data to the MQTT broker with QoS 1 delivery. </p>
<p>This function builds a JSON payload from the provided sensor data and publishes it to the specified MQTT topic. After publishing, it waits briefly for a PUBACK handshake from the broker to confirm delivery. If no acknowledgment is received within the timeout window, the data is saved to a CSV file for later recovery.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mqttClient</td><td>Reference to the MQTT client instance </td></tr>
    <tr><td class="paramname">topicPrefix</td><td>Topic prefix for MQTT publishing (e.g., "dhbw/ai/si2023/2/") </td></tr>
    <tr><td class="paramname">sensorType</td><td>Sensor type string (e.g., "temp") </td></tr>
    <tr><td class="paramname">sensorId</td><td>Unique sensor identifier </td></tr>
    <tr><td class="paramname">celsius</td><td>Measured temperature value in Celsius </td></tr>
    <tr><td class="paramname">now</td><td>Current timestamp (DateTime) </td></tr>
    <tr><td class="paramname">sequence</td><td>Sequence number for the measurement </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if published and acknowledged by broker, false if fallback to CSV</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Uses QoS 1 for reliable delivery. If broker does not echo/PUBACK within the timeout, data is persisted for later transmission. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aba2b7ae1d49c468937bdcded3695352b" name="aba2b7ae1d49c468937bdcded3695352b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba2b7ae1d49c468937bdcded3695352b">&#9670;&#160;</a></span>ACK_TIMEOUT_MS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned long ACK_TIMEOUT_MS = 5000</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ac4ded6926a35bdbecaf8318908797a51" name="ac4ded6926a35bdbecaf8318908797a51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4ded6926a35bdbecaf8318908797a51">&#9670;&#160;</a></span>DELAY_POLLING_LOOP_MS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned long DELAY_POLLING_LOOP_MS = 10</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="aa4d6a09459b76d7be490a8804e8bffe4" name="aa4d6a09459b76d7be490a8804e8bffe4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4d6a09459b76d7be490a8804e8bffe4">&#9670;&#160;</a></span>FILE_NAME_BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t FILE_NAME_BUFFER_SIZE = 64</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a633b6d91d2a6b9fe94d49679bf76cf8d" name="a633b6d91d2a6b9fe94d49679bf76cf8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a633b6d91d2a6b9fe94d49679bf76cf8d">&#9670;&#160;</a></span>FOLDER_NAME_BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t FOLDER_NAME_BUFFER_SIZE = 8</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ac89604b3a86db0dabb5538b2f3a5cdd6" name="ac89604b3a86db0dabb5538b2f3a5cdd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac89604b3a86db0dabb5538b2f3a5cdd6">&#9670;&#160;</a></span>FULL_PATH_BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t FULL_PATH_BUFFER_SIZE = 64</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="abafcc50ab7d3b296d64e26083a1a876e" name="abafcc50ab7d3b296d64e26083a1a876e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abafcc50ab7d3b296d64e26083a1a876e">&#9670;&#160;</a></span>LARGE_BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t LARGE_BUFFER_SIZE = 2048</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Buffer size for large MQTT payloads and JSON documents (recovery data) </p>

</div>
</div>
<a id="abb1c8ff7f876cef50bab38d6ac9a4d10" name="abb1c8ff7f876cef50bab38d6ac9a4d10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb1c8ff7f876cef50bab38d6ac9a4d10">&#9670;&#160;</a></span>LINE_BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t LINE_BUFFER_SIZE = 64</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Buffer size for reading individual CSV lines. </p>

</div>
</div>
<a id="a407875f5e946a88244a5d566c3d29d03" name="a407875f5e946a88244a5d566c3d29d03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a407875f5e946a88244a5d566c3d29d03">&#9670;&#160;</a></span>MAX_RECOVERY_FILES_PER_LOOP</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const int MAX_RECOVERY_FILES_PER_LOOP = 3</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ad1462ad318bc6cd52a0b6ce826ca946c" name="ad1462ad318bc6cd52a0b6ce826ca946c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1462ad318bc6cd52a0b6ce826ca946c">&#9670;&#160;</a></span>RECOVERY_ACK_TIMEOUT_MS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned long RECOVERY_ACK_TIMEOUT_MS = 10000</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a8fa547868639ebfd54dcfd92dc6f0dc7" name="a8fa547868639ebfd54dcfd92dc6f0dc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fa547868639ebfd54dcfd92dc6f0dc7">&#9670;&#160;</a></span>RECOVERY_TIMEOUT_MS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned long RECOVERY_TIMEOUT_MS = 60000</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Timeout for recovery operations in milliseconds (60 seconds) </p>

</div>
</div>
<a id="a8671bf831d0fbe6895dfdf718ba4ca1c" name="a8671bf831d0fbe6895dfdf718ba4ca1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8671bf831d0fbe6895dfdf718ba4ca1c">&#9670;&#160;</a></span>s_ackInit</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool s_ackInit = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="ad5cdeb03df0da73c08309eb1693816f4" name="ad5cdeb03df0da73c08309eb1693816f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5cdeb03df0da73c08309eb1693816f4">&#9670;&#160;</a></span>s_ackSeen</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">volatile bool s_ackSeen = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="af87e53fea3cf7b797a5bd30588380511" name="af87e53fea3cf7b797a5bd30588380511"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af87e53fea3cf7b797a5bd30588380511">&#9670;&#160;</a></span>s_ackSeq</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">volatile long s_ackSeq = -1</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a365552749e351abf6c38ffb0946ae993" name="a365552749e351abf6c38ffb0946ae993"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a365552749e351abf6c38ffb0946ae993">&#9670;&#160;</a></span>s_pubTopic</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">String s_pubTopic</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a700fb0855fc0d557992d5068df21e937" name="a700fb0855fc0d557992d5068df21e937"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a700fb0855fc0d557992d5068df21e937">&#9670;&#160;</a></span>SECONDS_IN_24_HOURS</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const uint32_t SECONDS_IN_24_HOURS = 86400</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a01d5af4481e953ac242d59bd4c22765f" name="a01d5af4481e953ac242d59bd4c22765f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01d5af4481e953ac242d59bd4c22765f">&#9670;&#160;</a></span>SMALL_BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const size_t SMALL_BUFFER_SIZE = 128</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Buffer size for small MQTT topics, payloads, and JSON documents. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
