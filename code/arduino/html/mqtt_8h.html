<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IsoPruefi Arduino: include/mqtt.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">IsoPruefi Arduino
   </div>
   <div id="projectbrief">Arduino firmware for IsoPruefi temperature monitoring system</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">mqtt.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="platform_8h_source.html">platform.h</a>&quot;</code><br />
</div>
<p><a href="mqtt_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa85ccfd4bec75d36415a21ab5696deef" id="r_aa85ccfd4bec75d36415a21ab5696deef"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8h.html#aa85ccfd4bec75d36415a21ab5696deef">SendTempToMqtt</a> (MqttClient &amp;<a class="el" href="mqtt_8h.html#aaf73b36dfdb5cafe8dbb8ca7563f7e56">mqttClient</a>, const char *topicPrefix, const char *sensorType, const char *sensorId, float celsius, const DateTime &amp;now, int sequence)</td></tr>
<tr class="memdesc:aa85ccfd4bec75d36415a21ab5696deef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publishes real-time sensor data to the MQTT broker with QoS 1 delivery.  <br /></td></tr>
<tr class="separator:aa85ccfd4bec75d36415a21ab5696deef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7eff2f450ca7353750649b94936d6cee" id="r_a7eff2f450ca7353750649b94936d6cee"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8h.html#a7eff2f450ca7353750649b94936d6cee">SendPendingDataToMqtt</a> (MqttClient &amp;<a class="el" href="mqtt_8h.html#aaf73b36dfdb5cafe8dbb8ca7563f7e56">mqttClient</a>, const char *topicPrefix, const char *sensorType, const char *sensorId, const DateTime &amp;now)</td></tr>
<tr class="memdesc:a7eff2f450ca7353750649b94936d6cee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes and transmits pending CSV files from offline periods to the MQTT broker.  <br /></td></tr>
<tr class="separator:a7eff2f450ca7353750649b94936d6cee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa82e7b190a9febce6021fef8138d2f28" id="r_aa82e7b190a9febce6021fef8138d2f28"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8h.html#aa82e7b190a9febce6021fef8138d2f28">CreateFullTopic</a> (char *buffer, size_t bufferSize, const char *topicPrefix, const char *sensorType, const char *sensorId, const char *suffix=&quot;&quot;)</td></tr>
<tr class="separator:aa82e7b190a9febce6021fef8138d2f28"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aaf73b36dfdb5cafe8dbb8ca7563f7e56" id="r_aaf73b36dfdb5cafe8dbb8ca7563f7e56"><td class="memItemLeft" align="right" valign="top">MqttClient&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mqtt_8h.html#aaf73b36dfdb5cafe8dbb8ca7563f7e56">mqttClient</a></td></tr>
<tr class="separator:aaf73b36dfdb5cafe8dbb8ca7563f7e56"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="aa82e7b190a9febce6021fef8138d2f28" name="aa82e7b190a9febce6021fef8138d2f28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa82e7b190a9febce6021fef8138d2f28">&#9670;&#160;</a></span>CreateFullTopic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CreateFullTopic </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bufferSize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topicPrefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>suffix</em> = <code>&quot;&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a7eff2f450ca7353750649b94936d6cee" name="a7eff2f450ca7353750649b94936d6cee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7eff2f450ca7353750649b94936d6cee">&#9670;&#160;</a></span>SendPendingDataToMqtt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SendPendingDataToMqtt </td>
          <td>(</td>
          <td class="paramtype">MqttClient &amp;&#160;</td>
          <td class="paramname"><em>mqttClient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topicPrefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DateTime &amp;&#160;</td>
          <td class="paramname"><em>now</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes and transmits pending CSV files from offline periods to the MQTT broker. </p>
<p>This function scans the SD card for CSV files containing unsent sensor data from previous offline periods. Each file is converted to a JSON payload and published to the MQTT topic &lt;topic&gt;/recovered with QoS 1. After publishing, it waits briefly for a PUBACK handshake from the broker to confirm delivery. If the PUBACK is not received within the timeout period, the file is saved for later transmission. Files are only deleted if the publish operation succeeds. Files older than 24 hours or with invalid data are skipped.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mqttClient</td><td>Reference to the MQTT client instance </td></tr>
    <tr><td class="paramname">topicPrefix</td><td>Topic prefix for MQTT publishing (e.g., "dhbw/ai/si2023/2/") </td></tr>
    <tr><td class="paramname">sensorType</td><td>Sensor type string (e.g., "temp") </td></tr>
    <tr><td class="paramname">sensorId</td><td>Unique sensor identifier </td></tr>
    <tr><td class="paramname">now</td><td>Current timestamp (DateTime) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if all valid files were published and deleted, false if any files remain or errors occurred</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Uses QoS 1 for reliable delivery. Skips files older than 24 hours or with invalid content. Aborts if recovery exceeds time limit. </dd></dl>

</div>
</div>
<a id="aa85ccfd4bec75d36415a21ab5696deef" name="aa85ccfd4bec75d36415a21ab5696deef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa85ccfd4bec75d36415a21ab5696deef">&#9670;&#160;</a></span>SendTempToMqtt()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool SendTempToMqtt </td>
          <td>(</td>
          <td class="paramtype">MqttClient &amp;&#160;</td>
          <td class="paramname"><em>mqttClient</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topicPrefix</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>sensorId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>celsius</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const DateTime &amp;&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sequence</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publishes real-time sensor data to the MQTT broker with QoS 1 delivery. </p>
<p>This function builds a JSON payload from the provided sensor data and publishes it to the specified MQTT topic. After publishing, it waits briefly for a PUBACK handshake from the broker to confirm delivery. If no acknowledgment is received within the timeout window, the data is saved to a CSV file for later recovery.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mqttClient</td><td>Reference to the MQTT client instance </td></tr>
    <tr><td class="paramname">topicPrefix</td><td>Topic prefix for MQTT publishing (e.g., "dhbw/ai/si2023/2/") </td></tr>
    <tr><td class="paramname">sensorType</td><td>Sensor type string (e.g., "temp") </td></tr>
    <tr><td class="paramname">sensorId</td><td>Unique sensor identifier </td></tr>
    <tr><td class="paramname">celsius</td><td>Measured temperature value in Celsius </td></tr>
    <tr><td class="paramname">now</td><td>Current timestamp (DateTime) </td></tr>
    <tr><td class="paramname">sequence</td><td>Sequence number for the measurement </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if published and acknowledged by broker, false if fallback to CSV</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Uses QoS 1 for reliable delivery. If broker does not echo/PUBACK within the timeout, data is persisted for later transmission. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aaf73b36dfdb5cafe8dbb8ca7563f7e56" name="aaf73b36dfdb5cafe8dbb8ca7563f7e56"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf73b36dfdb5cafe8dbb8ca7563f7e56">&#9670;&#160;</a></span>mqttClient</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">MqttClient mqttClient</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
